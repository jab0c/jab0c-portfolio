---
import SectionHeader from "./SectionHeader.astro";
import { experience, education } from "../data/content";
import SectionShell from "./SectionShell.astro";

// Sort oldest → newest using the *start* date in `when` (e.g. "06/2022 → 12/2022")
const toStartKey = (when) => {
    const start = when.split("→")[0].trim(); // left side
    const m = start.match(/(\d{1,2})\/(\d{4})/); // mm/yyyy
    if (m) {
        const mm = Number(m[1]);
        const yy = Number(m[2]);
        return yy * 12 + mm;
    }
    const y = start.match(/(\d{4})/); // fallback year
    if (y) return Number(y[1]) * 12;
    return 0;
};

const byWhenAsc = (a, b) => toStartKey(a.when) - toStartKey(b.when);

const exp = [...experience].sort(byWhenAsc);
const edu = [...education].sort(byWhenAsc);
---

<SectionShell id="experience" class="mx-auto max-w-6xl px-4 pt-14">
    <div class="grid gap-10 lg:grid-cols-2">
        <!-- EXPERIENCE -->
        <div>
            <SectionHeader title="Experience" subtitle="Clear, chronological highlights (newest at the bottom)." />

            <ol class="relative mt-6 space-y-6 border-l border-white/10 pl-6">
                {exp.map((e) => (
                        <li class="relative">
              <span
                      class="absolute -left-[0.55rem] top-3 h-3 w-3 rounded-full bg-[color:var(--accent)]
                   shadow-[0_0_0_4px_rgba(255,255,255,0.04)]"
              ></span>

                            <div class="rounded-2xl border border-[color:var(--border)] bg-[color:var(--card2)] p-4">
                                <div class="flex flex-wrap items-baseline gap-x-2 text-xs text-[color:var(--muted)]">
                                    <span>{e.when}</span>
                                    <span>•</span>
                                    <span>{e.location}</span>
                                </div>

                                <div class="mt-1 font-semibold leading-snug">{e.title}</div>
                                <div class="mt-1 text-sm text-[color:var(--muted)]">{e.org}</div>

                                {e.bullets?.length ? (
                                        <ul class="mt-3 list-disc pl-5 text-sm text-[color:var(--muted)] space-y-1">
                                            {e.bullets.map((b) => <li>{b}</li>)}
                                        </ul>
                                ) : null}
                            </div>
                        </li>
                ))}
            </ol>
        </div>

        <!-- EDUCATION -->
        <div>
            <SectionHeader title="Education" subtitle="Milestones and focus areas." />

            <ol class="relative mt-6 space-y-6 border-l border-white/10 pl-6">
                {edu.map((e) => (
                        <li class="relative">
                            <span class="absolute -left-[0.55rem] top-3 h-3 w-3 rounded-full bg-white/40"></span>

                            <div class="rounded-2xl border border-[color:var(--border)] bg-[color:var(--card2)] p-4">
                                <div class="flex flex-wrap items-baseline gap-x-2 text-xs text-[color:var(--muted)]">
                                    <span>{e.when}</span>
                                    <span>•</span>
                                    <span>{e.location}</span>
                                </div>

                                <div class="mt-1 font-semibold leading-snug">{e.title}</div>
                                <div class="mt-1 text-sm text-[color:var(--muted)]">{e.org}</div>

                                {e.details ? (
                                        <div class="mt-2 text-sm text-[color:var(--muted)]">{e.details}</div>
                                ) : null}

                                {e.bullets?.length ? (
                                        <ul class="mt-3 list-disc pl-5 text-sm text-[color:var(--muted)] space-y-1">
                                            {e.bullets.map((b) => <li>{b}</li>)}
                                        </ul>
                                ) : null}
                            </div>
                        </li>
                ))}
            </ol>
        </div>
    </div>
</SectionShell>
